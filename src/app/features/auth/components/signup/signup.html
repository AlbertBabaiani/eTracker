<div class="shell" *transloco="let s; prefix: 'AUTH.SIGNUP'">
  <mat-card class="card">
    <div class="language-container">
      <app-language-switcher />
    </div>

    <!-- Success State: Verification Email Sent -->
    @if (emailSent()) {
    <div class="success-state center-header">
      <mat-icon class="large-icon">mark_email_read</mat-icon>
      <h1 class="title">{{ s('VERIFICATION_SENT.TITLE') }}</h1>
      <p>{{ s('VERIFICATION_SENT.MESSAGE', { email: sentEmailAddress() }) }}</p>
      <button mat-flat-button color="primary" routerLink="/signin" class="submit-btn">
        {{ s('VERIFICATION_SENT.GO_TO_LOGIN') }}
      </button>
    </div>
    }

    <!-- Sign Up Form -->
    @else {
    <mat-card-header class="center-header">
      <div class="brand-logo">
        <app-logo [logoLg]="true" [vertical]="true" />
      </div>
      <h1 class="title">{{ s('TITLE') }}</h1>
    </mat-card-header>

    <mat-card-content *transloco="let f; prefix: 'AUTH.FORM'">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <mat-stepper [linear]="true" #stepper>
          <!-- STEP 1: Personal Information -->
          <mat-step [stepControl]="personalGroup" formGroupName="personal">
            <ng-template matStepLabel>{{ s('STEPS.PERSONAL') }}</ng-template>

            <div class="step-content">
              <app-user-personal-form [group]="personalGroup" />

              <div class="step-actions">
                <button
                  mat-flat-button
                  [disabled]="personalGroup.invalid"
                  color="primary"
                  matStepperNext
                  type="button"
                >
                  {{ f('STEP_BUTTONS.NEXT') }}
                </button>
              </div>
            </div>
          </mat-step>

          <!-- STEP 2: Account Details -->
          <mat-step [stepControl]="accountGroup" formGroupName="account">
            <ng-template matStepLabel>{{ s('STEPS.ACCOUNT') }}</ng-template>

            <div class="step-content">
              <app-user-account-fields [group]="accountGroup" [showConfirmPassword]="true" />

              <div class="step-actions">
                <button mat-button matStepperPrevious type="button">
                  {{ f('STEP_BUTTONS.BACK') }}
                </button>
                <button mat-flat-button color="primary" matStepperNext type="button">
                  {{ f('STEP_BUTTONS.NEXT') }}
                </button>
              </div>
            </div>
          </mat-step>

          <!-- STEP 3: Confirm Email / Finalize -->
          <mat-step>
            <ng-template matStepLabel>{{ s('STEPS.CONFIRM') }}</ng-template>

            <div class="step-content confirm-step">
              <mat-icon class="email-icon">mark_email_unread</mat-icon>

              <p>{{ s('CONFIRM_TEXT') }}</p>

              <h3 class="confirm-email-display">
                {{ accountGroup.get('email')?.value }}
              </h3>

              <div class="step-actions">
                <button mat-button matStepperPrevious type="button">Back</button>
                <button
                  class="submit-btn"
                  mat-flat-button
                  color="primary"
                  type="submit"
                  [disabled]="form.invalid"
                >
                  {{ s('BUTTON') }}
                </button>
              </div>
            </div>
          </mat-step>
        </mat-stepper>
      </form>
    </mat-card-content>

    <mat-card-footer class="auth-footer">
      <p>
        {{ s('HAVE_ACCOUNT') }} <a routerLink="/signin">{{ s('LOGIN') }}</a>
      </p>
    </mat-card-footer>
    }
  </mat-card>
</div>
